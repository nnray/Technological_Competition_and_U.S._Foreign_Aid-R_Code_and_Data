---
title: 'Research Project'
author: "Nicholas Ray"
date: "9/20/2022"
output: pdf_document
---
```{r libraries, include=FALSE,warning=FALSE,message=FALSE}
library(here)
library(car)
library(readxl)
library(utils)
library(spatialreg)
library(stargazer)
library(rgdal)
library(ggplot2)
library(utils)
library(sf)
library(sp)
library(sfExtras)
library(spdep)
library(tmaptools)
library(tmap)
library(spData)
library(geodist)
library(shiny)
library(shinyjs)
library(vars)
library(tidyverse)
library(plm)
library(lmtest)
library(margins)
library(marginaleffects)
library(sjPlot)
library(urca)
library(vtable)
```
```{r data, warning=FALSE}
USaid<-read.csv(here("Data", "Aid", "us_foreign_aid_country.csv"))
unzip(here("Data", "Aid", "aiddataChina", "AidDatasGlobalChineseDevelopmentFinanceDataset_v2.0.zip"))
Caid<-read_excel(here("Code", "AidDatasGlobalChineseDevelopmentFinanceDataset_v2.0.xlsx"), sheet = 5)
unzip(here("Data", "InternetFreedom", "DSP-Dataset-v4.zip"))
DSP<-read.csv(here("Code", "DSP-Dataset-v4.csv"))
Polity<-read_excel(here("Data", "PoliticalFreedom", "p5v2018.xls"))
unzip(here("Data", "InternetInfrastructure", "ddd_dataset.zip"))
ITU<-read_excel(here("Code", "ddd_dataset.xlsx"))
unzip(here("Data", "GDP", "UNdata_Export_20221013_234232609.zip"))
GDP<-read.csv(here("Code", "UNdata_Export_20221013_234232609.csv"))
```
```{r cleaning, include=FALSE,warning=FALSE,message=FALSE}
Caid["Recipient"][Caid["Recipient"] == "Congo"] <- "Republic of the Congo"
Caid<- subset(Caid, Recipient %in% c("Algeria","Angola","Benin","Botswana","Burundi","Cabo Verde","Cameroon",
                                 "Central African Republic","Chad","Comoros","Republic of the Congo","Cote d'Ivoire",
                                 "Democratic Republic of the Congo","Djibouti","Egypt","Equatorial Guinea",
                                 "Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau",
                                 "Kenya","Lesotho","Liberia", "Madagascar","Malawi","Mali","Mauritania",
                                 "Mauritius","Morocco","Mozambique","Namibia","Niger","Nigeria","Rwanda","Senegal","Sierra Leone",
                                 "South Africa","Togo","Tunisia","Uganda",
                                 "Zambia","Zimbabwe"))
Caid<- Caid %>%
  filter(`Recommended For Aggregates` == "Yes" & `Commitment Year` > "2009") %>%
  select(`Recipient`,`Commitment Year`,`Amount (Nominal)`,
         `Amount (Constant USD2017)`)
Caid1<- Caid %>%
  group_by(`Recipient`,`Commitment Year`) %>%
  summarise(caid_usdconstant2017=sum(`Amount (Constant USD2017)`))
Caid2<- Caid %>%
  group_by(`Recipient`,`Commitment Year`) %>%
  summarise(caid_usdcurrent=sum(`Amount (Nominal)`))
Caid<- full_join(Caid1, Caid2, by = c("Recipient","Commitment Year"),keep=TRUE)
Caid<-rename(Caid,year=`Commitment Year.x`)
Caid<-rename(Caid, country = Recipient.x)
Caid<- select(Caid, `year`,`country`,`caid_usdconstant2017`,`caid_usdcurrent`)
Caid3<- Caid %>% 
  group_by(country) %>% 
  mutate(Earliest.Year = 2010) %>%
  select(-caid_usdconstant2017, -year, -caid_usdcurrent) %>% 
  distinct() %>%
  expand(year = Earliest.Year:2017, Earliest.Year) %>%
  select(-Earliest.Year)
Caid<- Caid3 %>%
  left_join(Caid, by = c("country", "year"))
DSP["country_name"][DSP["country_name"] == "Cape Verde"] <- "Cabo Verde"
DSP["country_name"][DSP["country_name"] == "Ivory Coast"] <- "Cote d'Ivoire"
DSP["country_name"][DSP["country_name"] == "The Gambia"] <- "Gambia"
DSP<- subset(DSP, country_name %in% c("Algeria","Angola","Benin","Botswana","Burundi","Cabo Verde","Cameroon",
                                 "Central African Republic","Chad","Comoros","Republic of the Congo","Cote d'Ivoire",
                                 "Democratic Republic of the Congo","Djibouti","Egypt","Equatorial Guinea",
                                 "Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau",
                                 "Kenya","Lesotho","Liberia", "Madagascar","Malawi","Mali","Mauritania",
                                 "Mauritius","Morocco","Mozambique","Namibia","Niger","Nigeria","Rwanda","Senegal","Sierra Leone",
                                 "South Africa","Togo","Tunisia","Uganda",
                                 "Zambia","Zimbabwe"))
#v2smhargr error, v2smorgtypes error
DSP<- DSP %>%
  group_by(country_name, year) %>% 
  mutate(dsp=sum(v2smgovdom,v2smgovab,v2smpardom,v2smparab,v2smfordom,v2smforads,v2smgovfilcap,v2smgovfilprc,v2smgovshutcap,v2smgovshut,v2smgovsm,v2smgovsmalt,v2smgovsmmon,v2smgovsmcenprc,v2smgovcapsec,v2smpolcap,v2smregcon,v2smprivex,v2smprivcon,v2smregcap,v2smregapp,v2smlawpr,v2smdefabu,v2smonex,v2smonper,v2smmefra,v2smorgviol,v2smorgavgact,v2smorgelitact,v2smcamp,v2smarrest,v2smpolsoc,v2smpolhate))
DSP<- DSP %>%
  filter(`year` > "2009" & year < "2018") %>%
  select(`country_name`,`country_text_id`,`country_id`,`year`,`COWcode`,`dsp`)
DSP<-rename(DSP,country=country_name)
ITU<- subset(ITU, `Indicator name` %in% c("Individuals using the Internet, total (%)"))
ITU["Country"][ITU["Country"] == "Central African Rep."] <- "Central African Republic"
ITU["Country"][ITU["Country"] == "Congo (Rep. of the)"] <- "Republic of the Congo"
ITU["Country"][ITU["Country"] == "Côte d'Ivoire"] <- "Cote d'Ivoire"
ITU["Country"][ITU["Country"] == "Dem. Rep. of the Congo"] <- "Democratic Republic of the Congo"
ITU<- subset(ITU, Country %in% c("Algeria","Angola","Benin","Botswana","Burundi","Cabo Verde","Cameroon",
                                 "Central African Republic","Chad","Comoros","Republic of the Congo","Cote d'Ivoire",
                                 "Democratic Republic of the Congo","Djibouti","Egypt","Equatorial Guinea",
                                 "Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau",
                                 "Kenya","Lesotho","Liberia", "Madagascar","Malawi","Mali","Mauritania",
                                 "Mauritius","Morocco","Mozambique","Namibia","Niger","Nigeria","Rwanda","Senegal","Sierra Leone",
                                 "South Africa","Togo","Tunisia","Uganda",
                                 "Zambia","Zimbabwe"))
ITU<- ITU %>%
  filter(`Year` > "2009" & `Year` < "2018") %>%
  select(`Country`,`Indicator name`, `Year`,`Value`)
ITU<-rename(ITU, country = Country)
ITU<-rename(ITU, year= Year)
ITU<-rename(ITU, indicator=`Indicator name`)
ITU<-rename(ITU, internet=Value) #total percent of individuals using internet
ITU<- transform(ITU, internet=as.numeric(internet))
ITU<- ITU %>%
  select(`country`,`year`,`internet`)
#replace Libya's missing values... not sure how to justify this, but chose lowest observed value
ITU["internet"][is.na(ITU["internet"])] <- 14.000000
USaid<- subset(USaid, `Transaction.Type.Name` %in% c("Disbursements"))
USaid["Country.Name"][USaid["Country.Name"] == "Congo (Brazzaville)"]<- "Republic of the Congo"
USaid["Country.Name"][USaid["Country.Name"] == "Congo (Kinshasa)"]<- "Democratic Republic of the Congo"
USaid<- subset(USaid, `Country.Name` %in% c("Algeria","Angola","Benin","Botswana","Burundi","Cabo Verde","Cameroon",
                                 "Central African Republic","Chad","Comoros","Republic of the Congo","Cote d'Ivoire",
                                 "Democratic Republic of the Congo","Djibouti","Egypt","Equatorial Guinea",
                                 "Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau",
                                 "Kenya","Lesotho","Liberia", "Madagascar","Malawi","Mali","Mauritania",
                                 "Mauritius","Morocco","Mozambique","Namibia","Niger","Nigeria","Rwanda","Senegal","Sierra Leone",
                                 "South Africa","Togo","Tunisia","Uganda",
                                 "Zambia","Zimbabwe"))
USaid<- USaid %>%
  filter(`Fiscal.Year` > "2009" & `Fiscal.Year` < "2018") %>%
  select(`Country.Name`,`Fiscal.Year`,`constant_amount`,`current_amount`)
USaid<-rename(USaid, country = Country.Name)
USaid<-rename(USaid, year=`Fiscal.Year`)
USaid<-rename(USaid, usaid_usdconstant2020=`constant_amount`) #US aid variable, constant USD. Need to make all dollar variables constant at same year
USaid<-rename(USaid, usaid_usdcurrent=`current_amount`)
USaid<-USaid %>% 
  select(`country`,`year`,`usaid_usdconstant2020`,`usaid_usdcurrent`)
USaid<-transform(USaid, year=as.numeric(year))
Polity["country"][Polity["country"] == "Cape Verde"] <- "Cabo Verde"
Polity["country"][Polity["country"] == "Congo-Brazzaville"] <- "Republic of the Congo"
Polity["country"][Polity["country"] == "Congo Brazzaville"] <- "Republic of the Congo"
Polity["country"][Polity["country"] == "Congo Kinshasa"] <- "Democratic Republic of the Congo"
Polity["country"][Polity["country"] == "Cote D'Ivoire"] <- "Cote d'Ivoire"
Polity["country"][Polity["country"] == "Ivory Coast"] <- "Cote d'Ivoire"
#no polity data for Sao Tome and Principe and Seychelles
Polity<-subset(Polity, `country` %in% c("Algeria","Angola","Benin","Botswana","Burundi","Cabo Verde","Cameroon",
                                 "Central African Republic","Chad","Comoros","Republic of the Congo","Cote d'Ivoire",
                                 "Democratic Republic of the Congo","Djibouti","Egypt","Equatorial Guinea",
                                 "Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau",
                                 "Kenya","Lesotho","Liberia", "Madagascar","Malawi","Mali","Mauritania",
                                 "Mauritius","Morocco","Mozambique","Namibia","Niger","Nigeria","Rwanda","Senegal","Sierra Leone",
                                 "South Africa","Togo","Tunisia","Uganda",
                                 "Zambia","Zimbabwe"))
Polity<- Polity %>%
  filter(`year` > "2009" & `year` < "2018") %>%
  select(`country`,`year`,`polity2`) 
GDP["Country.or.Area"][GDP["Country.or.Area"] == "CÃ´te d'Ivoire"] <- "Cote d'Ivoire"
GDP["Country.or.Area"][GDP["Country.or.Area"] == "Congo"] <- "Republic of the Congo"
GDP["Country.or.Area"][GDP["Country.or.Area"] == " Former Sudan"]<- "South Sudan"
GDP<-subset(GDP, `Country.or.Area` %in% c("Algeria","Angola","Benin","Botswana","Burundi","Cabo Verde","Cameroon",
                                 "Central African Republic","Chad","Comoros","Republic of the Congo","Cote d'Ivoire",
                                 "Democratic Republic of the Congo","Djibouti","Egypt","Equatorial Guinea",
                                 "Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau",
                                 "Kenya","Lesotho","Liberia","Madagascar","Malawi","Mali","Mauritania",
                                 "Mauritius","Morocco","Mozambique","Namibia","Niger","Nigeria","Rwanda","Senegal","Sierra Leone",
                                 "South Africa","Togo","Tunisia","Uganda",
                                 "Zambia","Zimbabwe"))
GDP<- GDP %>%
  filter(`Year` > "2009" & `Year` < "2018") %>%
  select(`Country.or.Area`,`Year`,`Value`)
#no GDP data for Tanzania
GDP<-rename(GDP,country=`Country.or.Area`)
GDP<-rename(GDP,year=Year)
GDP<-rename(GDP,gdp_usdconstant2015=Value)
data<- full_join(Caid, DSP, by = c("country","year")) %>%
  full_join(., ITU, by = c("country","year")) %>%
  full_join(., USaid, by = c("country","year")) %>%
  full_join(., Polity, by = c("country","year")) %>%
  full_join(., GDP, by = c("country","year"))
#eliminated Sudan, South Sudan, Eritrea, Somalia due to instability/missingness/absence of data from DSP/Polity
#also probably elimate Libya due to internet missing data and U.S. invasion
```
```{r rebasing}
deflator<-read.csv(here("Data","GDP","USAGDPDEFAISMEI.csv"))
#GDP deflator found here https://fred.stlouisfed.org/series/usagdpdefaismei
deflator<- rename(deflator,value=USAGDPDEFAISMEI)
deflator<- subset(deflator,value < 103 & value > 91) %>%
  select(value)
deflator<- as.matrix(deflator)
deflator<- deflator * 0.01
deflator<- rep(deflator,times=44)
deflator<- as.matrix(deflator)
data$caid<-diag(data$caid_usdcurrent) %*% deflator
data$usaid<-diag(data$usaid_usdcurrent) %*% deflator
data<- data %>%
  select(-caid_usdconstant2017,-caid_usdcurrent,-usaid_usdconstant2020,-usaid_usdcurrent) %>%
  rename(gdp=gdp_usdconstant2015)
data["caid"][is.na(data["caid"])] <- 0
data<-data %>%
  mutate(log_usaid=log(usaid)) %>%
  mutate(log_caid=log(caid)) %>%
  mutate(log_gdp=log(gdp))
data["log_caid"][data["log_caid"] == -Inf] <- 0
data["log_usaid"][is.na(data["log_usaid"])] <- 0
```
```{r shapefile, eval=FALSE}
unzip(here("Data","Shapefiles","Africa","afr_g2014_2013_0.zip"))
Africa<-st_read(here("Code","afr_g2014_2013_0.shp"))
Africa<- Africa %>%
  rename(country=ADM0_NAME) %>% 
  select(country, geometry)
Africa[7,1]<- "Cabo Verde"
Africa[12,1]<- "Cote d'Ivoire"
Africa[11,1]<- "Republic of the Congo"
Africa[44,1]<- "Tanzania"
data<-Africa %>%
  right_join(data)
tm_shape(data) + tm_polygons("caid") + tm_legend(outside = TRUE, hist.width = 2) + tm_layout(frame = FALSE)
```
```{r analysis}
sumtable(data)
data_panel<-pdata.frame(data, index=c("country", "year"))
pdim(data_panel)
model_pooled<-plm(log_usaid~dsp+log_caid+log_gdp+internet+polity2+factor(year),data=data_panel)
model_re<-plm(log_usaid~dsp+log_caid+log_gdp+internet+polity2,data=data_panel,effect = "twoways",model="random")
c_re<-vcovHC(model_re,cluster="group")
linearHypothesis(model_re, c("dsp=0"),vcov=c_re) #fe better than pooled
model_fe<-plm(log_usaid~dsp+log_caid+log_gdp+internet+polity2,data = data_panel,effect = "twoways",model = "within")
c_fe<-vcovHC(model_fe,cluster="group")
linearHypothesis(model_fe, c("dsp=0"), vcov=c_fe) #fe better than pooled
phtest(model_fe, model_re) #individual error terms are correlated with the regressors (should use fe)
summary(model_fe,vcov=c_fe)
(exp(model_fe$coefficients[1])-1)*100 #dsp coefficient interpretation 
```
```{r plots}
#margins(model_fe, variables = "dsp",vcov=c_fe)
#margins(model_fe, variables = "log_caid",vcov=c_fe)
dsp_plot<-plot_cap(model_fe, condition="dsp", vcov = c_fe)
dsp_plot<-dsp_plot+labs(title = "Figure 1: Average Marginal Effect of Internet Freedom on Logged U.S. Foreign Aid", subtitle = "Slope = 0.0206, meaning a one unit increase in internet freedom associated with a 2.08 percent increase in U.S. aid", x="Internet Freedom",y="Logged U.S. Foreign Aid")
caid_plot<-plot_cap(model_fe, condition="log_caid", vcov = c_fe)
caid_plot<-caid_plot+labs(title = "Figure 2: Average Marginal Effect of Logged Chinese Aid on Logged U.S. Foreign Aid", x="Logged Chinese Foreign Aid",subtitle = "Slope = 0.0058, meaning a one percent increase in Chinese aid associated with a 0.0058 percent increase in U.S. aid",y="Logged U.S. Foreign Aid")
```
```{r table1, message=FALSE, warning=FALSE, results='asis'}
c_fe2<-sqrt(diag(c_fe))
stargazer(model_fe,type = "latex",title = "Logged U.S. Aid and Covariates with Two-way Fixed Effects and Clustered SE's on Country",se=list(c_fe2))
```
```{r robustness, eval=FALSE}
summary(ur.df(data$dsp))
summary(ur.df(data$log_usaid))
summary(ur.df(data$log_caid))
summary(ur.df(data$log_gdp)) #nonstationary
#Must do panel unit root tests. Also look at equation balance from Paul/Pickup paper.
#Other robustness diagnostics
```